/*! thrust-js - v0.1.5 - 2013-01-05 */define("thrust/data/config",["require","exports"],function(e,t){t.resolve=["name","mediator","cfg"],t.conventions=["thrust/data/convention/start"],t.cache=!0,t.startTimeout=100,t.finishTimeout=2e3}),define("thrust/data/event.types",["require","exports"],function(e,t){t.wait="thrust/data/wait",t.start="thrust/data/start",t.status="thrust/data/status",t.stop="thrust/data/stop",t.event={beforeSend:"thrust/data/event/before-send",start:"thrust/data/event/start",send:"thrust/data/event/send",error:"thrust/data/event/error",success:"thrust/data/event/sucess",complete:"thrust/data/event/complete",stop:"thrust/data/event/stop"}}),define("thrust/data/event.factory",["require","exports","thrust/convention","thrust/util","./event.types"],function(e,t,n,r,i){function g(e,t){this.fire(p.beforeSend,e,t)}function E(e){for(var t in m){var n="ajax-"+t,r=y(t);t==="send"&&(r=h(w(t),this)),e.on(l(n)+this.namespace,r)}}var s=n,o=s.Convention,u=r,a=u._,f=i,l=u.camelCase,c=u.format,h=a.bind,p=f.event,d=Array.prototype.slice,v=a.memoize,m={"before-send":!0,send:!0,error:!0,success:!0,complete:!0,start:!0,stop:!0};t.beforeSendMethod=g;var y=v(function(e){var t=p[e];return function(){var e=d.call(arguments,0);e.unshift(t),this.fire.apply(this.fire.async,e)}}),b=function(e){e=e.split(" ");for(var t=0,n=e.length;t<n;t++){if(!m[e[t]])throw new Error(c('Event "{0}" is not a valid data event',e[t]));e[t]=p[e[t]]}return e.join(" ")},w=function(e){return function(t,n,r){if(!r.__mediator_data_fired__)throw n.abort(),new Error("Request aborted, all ajax calls must pass through thrust-data.");r.silent||y(e).apply(this,arguments)}};t.init=E}),define("thrust/data/response.queue",["require","exports","thrust/convention","thrust/util","./event.types","jquery","thrust/log","has"],function(e,t,n,r,i,s,o,u){var a=n,f=a.Convention,l=r,c=l._,h=i,p=s,d=o,v=u,m=Array.prototype.slice,g=l.format,y=c.extend,b=l.when,w=c.uniqueId,E=p.ajax,S=h.wait,x=h.start,T=h.stop,N=h.status,C={},k=function(e,t){return function(){e._xhr||(e._xhr=t,e.getAllResponseHeaders=function(){return e._xhr.getAllResponseHeaders()},e.getResponseHeader=function(){return e._xhr.getAllResponseHeadersgetResponseHeader()},e.abort=function(){return e._xhr.abort()},e.setRequestHeader=function(t,n){return e._xhr.setRequestHeader(t,n)}),e.responseText=t.responseText,e.responseXML=t.responseXML,e.readyState=t.readyState,e.status=t.status,e.statusText=t.statusText}},L=function(e){return function(){return e(c.toArray(arguments))}},A=function(e){return function(){return e.call(this,arguments[0][0])}},O=function(){function e(e,t,n){this.startTimeout=t,this.finishTimeout=n,this.module=e,this.namespace=e.namespace}return e.prototype.addToQueue=function(e,t,n){var r=b.defer(),i=this;if(n.beforeSend){var s=n.beforeSend;r.progress(function(e){if(e&&e=="before-send"){var t=m.call(arguments,1);s.apply(s,t)}}),delete n.beforeSend}n.complete&&(r.promise.always(n.complete),delete n.complete),n.success&&(r.promise.then(n.success),delete n.success),n.error&&(r.promise.otherwise(n.error),delete n.error);var o=!!C[e],u=C[e]||(C[e]={}),a=u.tail||(u.tail=u.next={});return y(a,{url:t,options:n,dfo:r}),u.tail=a.next={},o||b.delay(i.startTimeout).then(i.process(e)),r.promise},e.prototype.process=function(e){var t=C[e],n=t,r=this,i=w("dq");return!1,r.module.fire(S,i,e),function(){!1;var t=[],s=b.defer(),o=0;s.promise.then(function(){!1,r.module.fire(T,i,e,o)}),delete C[e];var u=n.tail,a=function(){r.module.fire(N,i,e,++o)};while((n=n.next)!==u){var f=n.dfo,l=y({},n.options),c=b.defer(),h=n.xhr=E(n.url,l).then(L(c.resolve),L(c.reject));c.promise.then(a),t.push(h),b.all([c,s.promise],b.apply(f.resolve),b.apply(f.reject),k(f,h)),f.progress("before-send",[f,l])}r.module.fire(x,i,e,t.length),b.any([b.all(t),b.delay(r.finishTimeout)],s.resolve,s.resolve)}},e}();t.ResponseQueue=O}),define("thrust/data/main",["require","exports","thrust/convention","thrust/util","jquery","thrust/log","./config","thrust/config","./event.factory","./response.queue","thrust/events","thrust/facade","./event.types","has"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=n,v=d.Convention,m=r,g=m._,y=i,b=s,w=o,E=u,S=a,x=f,T=x.ResponseQueue,N=l,C=N.Events,k=c,L=h,A=p;t.className="Data",w;var O=m.format,M=g.extend,_=m.type,D=m.when,P=Array.prototype.slice,H=y.ajax,B=g.uniqueId,j=L.wait,F=L.start,I=L.stop,q=L.status,R=function(e){return function(){return e(g.toArray(arguments))}};y.ajaxSettings.traditional=!!E.url.traditionalEncoding;var U=y(document);S.init(U);var z=function(){var e=k.createFacade(function(e,t){this.name=e.name+"-data",this.module=e,this.parent=t,this.__conventions=t.__conventions,this._callbacks=t._callbacks,this.responseQueue=t.responseQueue,this.initEvents(),this.defaults=t.defaults,this.appPath=t.appPath});return g.extend(e.prototype,N),e}(),W=function(){function e(e,t,n){if(!e)throw new Error("Data: module name must be defined.");this.name=e,this.responseQueue=new T(this,n.data.startTimeout,n.data.finishTimeout),!1,this.mediator=t,this._callbacks=this.mediator._callbacks,this.initEvents(),this.defaults={cache:n.data.cache,beforeSend:S.beforeSendMethod,contentType:"application/json",type:"POST",url:"",data:"",dataType:"json",__mediator_data_fired__:!0,silent:!1},this.appPath=n.url.path+"/"}return e.prototype.initEvents=function(){},e.prototype.extend=function(e,t){return null},e.prototype.subscribe=function(e,t,n,r){},e.prototype.unsubscribe=function(e,t,n){},e.prototype.once=function(e,t,n){},e.prototype.createFacade=function(e,t,n){if(!t.data||n.data instanceof z){var r;return n.data?(n.data.updateFacade(t,this),r=n.data):r=n.data=t.data=new z(t,this),r}throw new Error('"data" is a reserved property')},e.prototype.getData=function(e,t,n){return n=n?M(n,{data:t}):{data:t},this.get(e,n)},e.prototype.postData=function(e,t,n){return n=n?M(n,{data:JSON.stringify(t)}):{data:JSON.stringify(t)},this.post(e,n)},e.prototype.get=function(e,t){t===undefined&&typeof e=="object"&&(t=e,e=t.url),e===undefined&&t.url!==undefined&&(e=t.url);if(e===undefined)throw new Error("No url is defined");return this.ajax(e,M(t||{},{type:"get"}))},e.prototype.post=function(e,t){t===undefined&&typeof e=="object"&&(t=e,e=t.url),e===undefined&&t.url!==undefined&&(e=t.url);if(e===undefined)throw new Error("No url is defined");return this.ajax(e,M(t||{},{type:"post"}))},e.prototype.ajax=function(e,t){var n=this,r,i,s;!1,t===undefined&&typeof e=="object"&&(t=e,e=t.url),t||(t={}),e===undefined&&t.url!==undefined&&(e=t.url),e=m.fixupUrl(e,n.appPath);if(t.silent){var o=D.defer(),u=B("dq");return i=t.type.toLowerCase(),r=M({},n.defaults,{beforeSend:m.noop},t),H(e,r).then(R(o.resolve),R(o.reject)),o.promise}return r=M({},n.defaults,t,{beforeSend:S.beforeSendMethod}),i=r.type.toLowerCase(),this.responseQueue.addToQueue(i,e,r)},e.config=w,e}();t.Data=W,g.extend(W.prototype,C),g.extend(z.prototype,W.prototype),y.ajax=W.prototype.ajax}),define("thrust/data",["thrust/data/main"],function(e){return e}),define("thrust/data/convention/start",["require","exports","thrust/convention","thrust/util"],function(e,t,n,r){function l(e){var t=a.defer();t.resolver.uid=e,f.push({uid:e,resolver:t.resolver})}function c(e){var t=u.find(f,function(t){return t.uid===e});f=u.without(f,t),t.resolver.resolve()}var i=n,s=i.Convention,o=r,u=o._,a=o.when,f=[],h={countdown:function(e){e.data.subscribe("thrust/data/wait",l),e.data.subscribe("thrust/data/stop",c)},orbit:function(e){e.data.unsubscribe("thrust/data/wait",l),e.data.unsubscribe("thrust/data/stop",c);var t=a.defer();return e.cfg.data.finishTimeout===0?a.all(f):a.any([a.all(f),a.delay(e.cfg.data.finishTimeout)],t.resolve,t.reject)}};t.subscription=new s(h)});