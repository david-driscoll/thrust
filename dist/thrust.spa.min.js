/*! Thrust JS Framework - v0.1.0 - 2012-09-03
* thrust-home
* Copyright (c) 2012 David Driscoll; Licensed MIT */
define("thrust/spa/main",["require","thrust","thrust/util","thrust/log","davis","jquery","domReady"],function(a,b,c,d,e,f,g){var h=c.each,i=c.isString,j=c.isArray,k=c.isFunction,l=c.isObject,m=c.extend,n=c.once,o=c.when,p=c.bind,q=c.invoke,r=c.pluck,s=c.map,t=c.defer,u=c.memoize,v=c.toArray,w="start",x=function(a,b,c){e.$||(e.$=f);var d=this;d.baseUrl=a.url.path+"/",a=a.spa,d.thrustInstanceName=b,d.router=new e.App,d.router.configure(function(a){a.generateRequestOnPageLoad=!0}),d.loadRoutes(a.routes);var g=u(function(a){return function(){c.fire.async.apply(c,[a].concat(v(arguments)))}});d.router.bind("start",g("thrust/spa/start")),d.router.bind("lookupRoute",g("thrust/spa/route/lookup")),d.router.bind("runRoute",g("thrust/spa/route/run")),d.router.bind("routeNotFound",g("thrust/spa/route/notfound")),d.router.bind("requestHalted",g("thrust/spa/request/halt")),d.router.bind("unsupported",g("thrust/spa/unsupported"))};return x.prototype={start:function(){var a=this;a.router.start()},loadRoutes:function(a){var b=this;h(a,function(a,d){var e=c.fixupUrl(b.baseUrl+d);if(k(a))b.router.get(e,a);else{var f=b.__processRoute(a);b.router.get(e,f)}})},__processRoute:function(a){var b=this,c=a.args||[];if(l(a))return b.routeGetModuleFactory(a.path,c);if(i(a))return b.routeGetModuleFactory(a,c)},routeGetModuleFactory:function(a,b){var d=this;return function(e){var f;a.indexOf(":")>-1&&(f=c.reduce(e.params,function(a,b,c){return a.replace(":"+c,b.toLowerCase())},a),f.lastIndexOf(".")>-1&&(f=f.substring(0,f.lastIndexOf(".")))),d.startModules(b,f)}},startModules:function(a,c){var d=this;d.thrust||(d.thrust=b.getInstance(d.thrustInstanceName));if(j(c))h(c,function(b){t(function(){var c=d.thrust.start.apply(d.thrust,[b].concat(a));d.thrust.started||c.then(function(){d.thrust.ready(b)})})});else{var e=d.thrust.start.apply(d.thrust,[c].concat(a));d.thrust.started||e.then(function(){d.thrust.ready(c)}),d.startingModulePromise=[e]}}},x}),define("thrust/spa",["thrust/spa/main"],function(a){return a}),define("thrust/spa/convention/start",["thrust/convention","thrust/util"],function(a,b){return new a({orbit:function(a){var b=a.spa;return b.start(),a.spa.startingModulePromise||undefined}})});