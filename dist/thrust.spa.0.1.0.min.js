/*! thrust-js - v0.1.0 - 2013-01-01 */define("thrust/spa/config",["require","exports"],function(e,t){t.resolve=["cfg","name","mediator"],t.conventions=["thrust/spa/convention/start","thrust/spa/convention/spalink"],t.params={},t.routes={},t.fileExtension=".html"}),define("thrust/spa/main",["require","exports","thrust/util","thrust","thrust/log","has","flatiron/director","thrust/instance","./config"],function(e,t,n,r,i,s,o,u,a){var f=n,l=f._,c=r,h=c.Thrust,p=i,d=s,v=o,m=v.Router||v,g=u,y=a;t.className="SinglePageApplication",y;var b=l.each,w=l.isString,E=l.isArray,S=l.isFunction,x=l.isObject,T=l.isRegExp,N=l.extend,C=l.once,k=f.when,L=l.bind,A=l.invoke,O=l.pluck,M=l.map,_=l.defer,D=l.reduce,P=l.memoize,H=l.toArray,B=f.format,j="start",F=function(e){var t=[],n=e.indexOf(":"),r;while(n>-1)r=e.indexOf("/",n),r===-1&&(r=e.length),t.push(e.substring(n,r-n+1)),e=e.substring(r),n=e.indexOf(":");return t},I=function(e,t){return function(){!1,t.fire.async.apply(t,[e].concat(H(arguments)))}},q=function(){function e(e,t,n){this.startingModulePromise=null;var r=this;r.baseUrl=e.url.path;var i=e.spa;r.fileExtension=i.fileExtension;var s=r.configureRoutes(i.routes),o=i.params,u=P(function(e){return function(){!1,n.fire.async.apply(n,[e].concat(H(arguments)))}}),a=r.router=(new m(s)).configure({recurse:!1,strict:!1,async:!1,html5history:!0,notfound:u("thrust/spa/route/notfound"),before:u("thrust/spa/route/before"),on:u("thrust/spa/route/run"),after:u("thrust/spa/route/after")});l.each(o,function(e,t){a.param(t,e)}),r.start=function(){r.thrust=g.getInstance(t),r.router.init(),n.fire.async("thrust/spa/start")},r.navigate=r.navigate.bind(r)}return e.prototype.navigate=function(e){var t=this,n=f.fixupUrl(e,t.baseUrl);t.router.setRoute(n)},e.prototype.start=function(){this.thrust=g.getInstance(this.instanceName),this.router.init(),this.thrust.mediator.fire.async("thrust/spa/start")},e.prototype.configureRoutes=function(e){var t=this,n={};for(var r in e)if(l.has(e,r)){var i=e[r],s=f.fixupUrl(r,t.baseUrl);if(S(i))n[s]=i;else if(E(i)){var o=[],u=[];for(var a=0,c=i.length;a<c;a++){var h=i[h];w(h)||x(h)?o.push(h):S(h)&&u.push(h)}var p=t.moduleStartCallback(r,o);u.push(p),n[s]=u}else if(w(i)){var p=t.moduleStartCallback(r,i);n[s]=p}}return n},e.prototype.moduleStartCallback=function(e,t){var n=[],r=F(e),i=this,s=i.fileExtension;return x(t)&&(n=t.args||n,t=t.path),w(t)&&(t=[t]),function(){var e=H(arguments),o=i.thrust,u=M(t,function(t){return D(e,function(e,t,n){return e.replace(r[n],t.toLowerCase())},t).replace(s,"")}),a=o.start.apply(o,[u].concat(n));i.thrust.started||a.then(function(){o.ready(u,n)}),i.startingModulePromise=a}},e.prototype.createFacade=function(e,t,n){var r=this;if(t.navigate)throw new Error('"navigate" is a reserved property');return t.navigate=r.navigate.bind(r),null},e.config=y,e}();t.SinglePageApplication=q}),define("thrust/spa",["thrust/spa/main"],function(e){return e}),define("thrust/spa/convention/spalink",["require","exports","thrust/convention","thrust/util"],function(e,t,n,r){var i=n,s=i.Convention,o=r,u=o._,a=function(e){var t=location.pathname.substring(0,location.pathname.lastIndexOf("/"));return e.indexOf("/")!=-1?e=e.substring(e.lastIndexOf("/")):e="/"+e,t+e},f={orbit:function(e){var t=e.config,n=e.spa,r=e.dom.$;return r().on("click","a",function(e){var r=a(this.getAttribute("href"));if(r.indexOf(t.url.path)===0)return n.navigate(r),e.preventDefault(),e.stopImmediatePropagation(),!1}),null}};t.subscription=new s(f)}),define("thrust/spa/convention/start",["require","exports","thrust/convention","thrust/util"],function(e,t,n,r){var i=n,s=i.Convention,o=r,u=o._,a={orbit:function(e){var t=e.spa;return t.start(),e.spa.startingModulePromise||null}};t.subscription=new s(a)});