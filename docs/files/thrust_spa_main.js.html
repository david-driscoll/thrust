<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>thrust\spa\main.js - thrust-js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="thrust-js"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/thrust.config.html">thrust.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Convention.html">thrust.Convention</a></li>
            
                <li><a href="..&#x2F;classes/thrust.data.html">thrust.data</a></li>
            
                <li><a href="..&#x2F;classes/thrust.data.config.html">thrust.data.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.data.Data.html">thrust.data.Data</a></li>
            
                <li><a href="..&#x2F;classes/thrust.data.DataFacade.html">thrust.data.DataFacade</a></li>
            
                <li><a href="..&#x2F;classes/thrust.data.ResponseQueue.html">thrust.data.ResponseQueue</a></li>
            
                <li><a href="..&#x2F;classes/thrust.dom.config.html">thrust.dom.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.dom.convention.html">thrust.dom.convention</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Events.html">thrust.Events</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Facade.html">thrust.Facade</a></li>
            
                <li><a href="..&#x2F;classes/thrust.instance.html">thrust.instance</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Log.html">thrust.Log</a></li>
            
                <li><a href="..&#x2F;classes/thrust.mediator.html">thrust.mediator</a></li>
            
                <li><a href="..&#x2F;classes/thrust.mediator.config.html">thrust.mediator.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.mediator.convention.html">thrust.mediator.convention</a></li>
            
                <li><a href="..&#x2F;classes/thrust.mediator.Mediator.html">thrust.mediator.Mediator</a></li>
            
                <li><a href="..&#x2F;classes/thrust.mediator.MediatorFacade.html">thrust.mediator.MediatorFacade</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Module.html">thrust.Module</a></li>
            
                <li><a href="..&#x2F;classes/thrust.spa.html">thrust.spa</a></li>
            
                <li><a href="..&#x2F;classes/thrust.spa.config.html">thrust.spa.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.spa.convention.html">thrust.spa.convention</a></li>
            
                <li><a href="..&#x2F;classes/thrust.spa.SinglePageApp.html">thrust.spa.SinglePageApp</a></li>
            
                <li><a href="..&#x2F;classes/thrust.template.html">thrust.template</a></li>
            
                <li><a href="..&#x2F;classes/thrust.template.config.html">thrust.template.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.template.Template.html">thrust.template.Template</a></li>
            
                <li><a href="..&#x2F;classes/thrust.template.TemplateFacade.html">thrust.template.TemplateFacade</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Thrust.html">thrust.Thrust</a></li>
            
                <li><a href="..&#x2F;classes/thrust.util.html">thrust.util</a></li>
            
                <li><a href="..&#x2F;classes/thrust.util.url.html">thrust.util.url</a></li>
            
                <li><a href="..&#x2F;classes/thrust.util.when.html">thrust.util.when</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/thrust.html">thrust</a></li>
            
                <li><a href="..&#x2F;modules/thrust.config.html">thrust.config</a></li>
            
                <li><a href="..&#x2F;modules/thrust.data.html">thrust.data</a></li>
            
                <li><a href="..&#x2F;modules/thrust.data.config.html">thrust.data.config</a></li>
            
                <li><a href="..&#x2F;modules/thrust.dom.html">thrust.dom</a></li>
            
                <li><a href="..&#x2F;modules/thrust.dom.convention.html">thrust.dom.convention</a></li>
            
                <li><a href="..&#x2F;modules/thrust.mediator.html">thrust.mediator</a></li>
            
                <li><a href="..&#x2F;modules/thrust.mediator.config.html">thrust.mediator.config</a></li>
            
                <li><a href="..&#x2F;modules/thrust.mediator.convention.html">thrust.mediator.convention</a></li>
            
                <li><a href="..&#x2F;modules/thrust.spa.html">thrust.spa</a></li>
            
                <li><a href="..&#x2F;modules/thrust.spa.config.html">thrust.spa.config</a></li>
            
                <li><a href="..&#x2F;modules/thrust.spa.convention.html">thrust.spa.convention</a></li>
            
                <li><a href="..&#x2F;modules/thrust.template.html">thrust.template</a></li>
            
                <li><a href="..&#x2F;modules/thrust.template.config.html">thrust.template.config</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.html">thrust.util</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.func.html">thrust.util.func</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.type.html">thrust.util.type</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.url.html">thrust.util.url</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.when.html">thrust.util.when</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: thrust\spa\main.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define([&quot;require&quot;, &quot;exports&quot;, &#x27;thrust&#x2F;util&#x27;, &#x27;thrust&#x27;, &#x27;thrust&#x2F;log&#x27;, &#x27;has&#x27;, &#x27;flatiron&#x2F;director&#x27;, &#x27;thrust&#x2F;instance&#x27;, &#x27;.&#x2F;config&#x27;], function(require, exports, __util__, __thrust__, __log__, __has__, __flatironRouter__, __instance__, __config__) {
    &#x2F;&#x2F;&#x2F; &lt;reference path=&quot;..&#x2F;interfaces&#x2F;spa&#x2F;spa.d.ts&quot; &#x2F;&gt;
    &#x2F;&#x2F;&#x2F; &lt;reference path=&quot;..&#x2F;interfaces&#x2F;spa&#x2F;spa.facade.d.ts&quot; &#x2F;&gt;
    &#x2F;&#x2F;&#x2F; &lt;reference path=&quot;..&#x2F;interfaces&#x2F;spa&#x2F;spa.config.d.ts&quot; &#x2F;&gt;
    &#x2F;&#x2F;&#x2F; &lt;reference path=&quot;..&#x2F;interfaces&#x2F;mediator&#x2F;mediator.d.ts&quot; &#x2F;&gt;
    &#x2F;&#x2F;&#x2F; &lt;reference path=&quot;..&#x2F;..&#x2F;lib&#x2F;DefinitelyTyped&#x2F;requirejs&#x2F;require-2.1.d.ts&quot; &#x2F;&gt;
    &#x2F;&#x2F; Disabled until TS supports module per file in some way (ie exports is exports.&lt;export&gt; not  exports.moduleName.&lt;export&gt;)
    &#x2F;*export module instance {*&#x2F;
    &#x27;use strict&#x27;;
    var util = __util__;

    var _ = util._;
    var thrust = __thrust__;

    var Thrust = thrust.Thrust;
    var log = __log__;

    var has = __has__;

    var flatironRouter = __flatironRouter__;

    var Router = flatironRouter.Router || flatironRouter;
    
    var instance = __instance__;

    var config = __config__;

    exports.className = &#x27;SinglePageApplication&#x27;;
    config;
    var each = _.each, isString = _.isString, isArray = _.isArray, isFunction = _.isFunction, isObject = _.isObject, isRegExp = _.isRegExp, extend = _.extend, once = _.once, when = util.when, bind = _.bind, invoke = _.invoke, pluck = _.pluck, map = _.map, defer = _.defer, reduce = _.reduce, memoize = _.memoize, toArray = _.toArray, format = util.format, START = &#x27;start&#x27;;
    var extractParams = function (route) {
        var params = [], index = route.indexOf(&#x27;:&#x27;), slashIndex;
        while(index &gt; -1) {
            slashIndex = route.indexOf(&#x27;&#x2F;&#x27;, index);
            if(slashIndex === -1) {
                slashIndex = route.length;
            }
            params.push(route.substring(index, slashIndex - index + 1));
            route = route.substring(slashIndex);
            index = route.indexOf(&#x27;:&#x27;);
        }
        return params;
    };
    var eventFactory = function (event, mediator) {
        return function () {
            has(&#x27;DEBUG&#x27;) &amp;&amp; log.debug(format(&#x27;Firing spa &quot;{0}&quot; with [{1}]&#x27;, event, toArray(arguments).join(&#x27;,&#x27;)));
            mediator.fire.async.apply(mediator, [
                event
            ].concat(toArray(arguments)));
        }
    };
    &#x2F;**
    
    @for thrust.spa
    @class thrust.spa.SinglePageApp
    @constructor
    @param {Object} config The thrust instance configuration
    @param {String} instanceName The thrust instance name
    @param {thrust.mediatorMediator} mediator The thrust instance mediator
    **&#x2F;
    var SinglePageApplication = (function () {
        function SinglePageApplication(config, instanceName, mediator) {
            this.startingModulePromise = null;
            var that = this;
            that.baseUrl = config.url.path;
            var spaConfig = config.spa;
            that.fileExtension = spaConfig.fileExtension;
            var routes = that.configureRoutes(spaConfig.routes), params = spaConfig.params;
            var eventFactory = memoize(function (event) {
                return function () {
                    has(&#x27;DEBUG&#x27;) &amp;&amp; log.debug(format(&#x27;Firing spa &quot;{0}&quot; with [{1}]&#x27;, event, toArray(arguments).join(&#x27;,&#x27;)));
                    mediator.fire.async.apply(mediator, [
                        event
                    ].concat(toArray(arguments)));
                }
            });
            var router = that.router = new Router(routes).configure({
                recurse: false,
                strict: false,
                async: false,
                html5history: true,
                notfound: eventFactory(&#x27;thrust&#x2F;spa&#x2F;route&#x2F;notfound&#x27;),
                before: eventFactory(&#x27;thrust&#x2F;spa&#x2F;route&#x2F;before&#x27;),
                on: eventFactory(&#x27;thrust&#x2F;spa&#x2F;route&#x2F;run&#x27;),
                after: eventFactory(&#x27;thrust&#x2F;spa&#x2F;route&#x2F;after&#x27;)
            });
            _.each(params, function (x, i) {
                router.param(i, x);
            });
            &#x2F;**
            Start the single page app router.
            
            @method start
            **&#x2F;
            that.start = function () {
                that.thrust = instance.getInstance(instanceName);
                that.router.init();
                mediator.fire.async(&#x27;thrust&#x2F;spa&#x2F;start&#x27;);
            };
            that.navigate = that.navigate.bind(that);
        }
        &#x2F;**
        Navigates to the given url.
        
        @method navigate
        @param {String} location The location to navigate to.
        **&#x2F;
                SinglePageApplication.prototype.navigate = function (location) {
            var that = this;
            var url = util.fixupUrl(location, that.baseUrl);
            that.router.setRoute(url);
        }&#x2F;**
        Start the single page app router.
        
        @method start
        **&#x2F;
        ;
        SinglePageApplication.prototype.start = function () {
            this.thrust = instance.getInstance(this.instanceName);
            this.router.init();
            this.thrust.mediator.fire.async(&#x27;thrust&#x2F;spa&#x2F;start&#x27;);
        }&#x2F;**
        Configures the route object for the spa instance
        
        Routes can be in 4 forms
        
        {
        &#x27;&#x2F;path&#x2F;to&#x2F;:foo&#x27;: &#x27;path&#x2F;to&#x2F;module&#x27;,
        &#x27;&#x2F;path&#x2F;to&#x2F;:bar&#x27;: [&#x27;path&#x2F;to&#x2F;module1&#x27;, &#x27;path&#x2F;to&#x2F;module2&#x27;],
        &#x27;&#x2F;path&#x2F;to&#x2F;:fb&#x27;: { path: &#x27;path&#x2F;to&#x2F;module&#x27;, args: [&#x27;args&#x27;, &#x27;to&#x27;, &#x27;hand off to start&#x27;] }
        &#x27;&#x2F;path&#x2F;to&#x2F;:foo&#x2F;:bar&#x27;: function(foo, bar){  custom handler }
        }
        
        @method configureRoutes
        @param {Object} routes Object of routes.
        **&#x2F;
        ;
        SinglePageApplication.prototype.configureRoutes = function (routes) {
            var that = this, configuredRoutes = {
            };
            &#x2F;&#x2F; each(routes, function (value, route) {
            for(var route in routes) {
                if(_.has(routes, route)) {
                    var value = routes[route];
                    var realRoute = util.fixupUrl(route, that.baseUrl);
                    if(isFunction(value)) {
                        configuredRoutes[realRoute] = value;
                    } else {
                        if(isArray(value)) {
                            var modules = [], methods = [];
                            for(var i = 0, iLen = value.length; i &lt; iLen; i++) {
                                var v = value[v];
                                if(isString(v) || isObject(v)) {
                                    modules.push(v);
                                } else {
                                    if(isFunction(v)) {
                                        methods.push(v);
                                    }
                                }
                            }
                            var moduleCallback = that.moduleStartCallback(route, modules);
                            methods.push(moduleCallback);
                            configuredRoutes[realRoute] = methods;
                        } else {
                            if(isString(value)) {
                                var moduleCallback = that.moduleStartCallback(route, value);
                                configuredRoutes[realRoute] = moduleCallback;
                            }
                        }
                    }
                }
            }
            &#x2F;&#x2F;});
            return configuredRoutes;
        }&#x2F;**
        
        @method moduleStartCallback
        @private
        @param {String | Array | Object} modules String to start a single module, Array to start many modules, Object to start a module with specific arguments.
        **&#x2F;
        ;
        SinglePageApplication.prototype.moduleStartCallback = function (route, modules) {
            var args = [], params = extractParams(route), that = this, fileExtension = that.fileExtension;
            if(isObject(modules)) {
                args = modules.args || args;
                modules = modules.path;
            }
            if(isString(modules)) {
                modules = [
                    modules
                ];
            }
            return function () {
                var ar = toArray(arguments), thrust = that.thrust, mappedModules = map(modules, function (modulePath) {
return reduce(ar, function (memo, arg, i) {
return memo.replace(params[i], arg.toLowerCase());                    }, modulePath).replace(fileExtension, &#x27;&#x27;);                });
                var promise = thrust.start.apply(thrust, [
                    mappedModules
                ].concat(args));
                if(!that.thrust.started) {
                    promise.then(function () {
                        thrust.ready(mappedModules, args);
                    });
                }
                that.startingModulePromise = promise;
            }
        }&#x2F;**
        Hands the navigate method off to the module, so any module can trigger a navigation event.
        
        @for thrust.spa.SinglePageApp
        @method createFacade
        @param {thrust.Thrust} thrust The thrust instance
        @param {thrust.Module} mod The module to create the facade for
        @param {Object} facades The facades already added for this module.
        **&#x2F;
        ;
        SinglePageApplication.prototype.createFacade = function (thrust, mod, facades) {
            var that = this;
            if(mod.navigate) {
                throw new Error(&#x27;&quot;navigate&quot; is a reserved property&#x27;);
            }
            &#x2F;&#x2F; Already pre bound, so we only pass around 1 function per instance.
            mod.navigate = that.navigate.bind(that);
            return null;
        };
        SinglePageApplication.config = config;
        return SinglePageApplication;
    })();
    exports.SinglePageApplication = SinglePageApplication;    
})
&#x2F;&#x2F;@ sourceMappingURL=main.js.map

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
