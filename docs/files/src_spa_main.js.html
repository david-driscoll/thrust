<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\spa\main.js - Thrust JS Framework</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="Thrust JS Framework"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/thrust.config.html">thrust.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Convention.html">thrust.Convention</a></li>
            
                <li><a href="..&#x2F;classes/thrust.data.html">thrust.data</a></li>
            
                <li><a href="..&#x2F;classes/thrust.data.config.html">thrust.data.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.data.convention.html">thrust.data.convention</a></li>
            
                <li><a href="..&#x2F;classes/thrust.data.Data.html">thrust.data.Data</a></li>
            
                <li><a href="..&#x2F;classes/thrust.data.DataFacade.html">thrust.data.DataFacade</a></li>
            
                <li><a href="..&#x2F;classes/thrust.data.ResponseQueue.html">thrust.data.ResponseQueue</a></li>
            
                <li><a href="..&#x2F;classes/thrust.dom.config.html">thrust.dom.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.dom.convention.html">thrust.dom.convention</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Events.html">thrust.Events</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Facade.html">thrust.Facade</a></li>
            
                <li><a href="..&#x2F;classes/thrust.instance.html">thrust.instance</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Log.html">thrust.Log</a></li>
            
                <li><a href="..&#x2F;classes/thrust.mediator.html">thrust.mediator</a></li>
            
                <li><a href="..&#x2F;classes/thrust.mediator.config.html">thrust.mediator.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.mediator.convention.html">thrust.mediator.convention</a></li>
            
                <li><a href="..&#x2F;classes/thrust.mediator.Mediator.html">thrust.mediator.Mediator</a></li>
            
                <li><a href="..&#x2F;classes/thrust.mediator.MediatorFacade.html">thrust.mediator.MediatorFacade</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Module.html">thrust.Module</a></li>
            
                <li><a href="..&#x2F;classes/thrust.spa.html">thrust.spa</a></li>
            
                <li><a href="..&#x2F;classes/thrust.spa.config.html">thrust.spa.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.spa.convention.html">thrust.spa.convention</a></li>
            
                <li><a href="..&#x2F;classes/thrust.spa.SinglePageApp.html">thrust.spa.SinglePageApp</a></li>
            
                <li><a href="..&#x2F;classes/thrust.template.html">thrust.template</a></li>
            
                <li><a href="..&#x2F;classes/thrust.template.config.html">thrust.template.config</a></li>
            
                <li><a href="..&#x2F;classes/thrust.template.convention.html">thrust.template.convention</a></li>
            
                <li><a href="..&#x2F;classes/thrust.template.Template.html">thrust.template.Template</a></li>
            
                <li><a href="..&#x2F;classes/thrust.template.TemplateFacade.html">thrust.template.TemplateFacade</a></li>
            
                <li><a href="..&#x2F;classes/thrust.Thrust.html">thrust.Thrust</a></li>
            
                <li><a href="..&#x2F;classes/thrust.util.html">thrust.util</a></li>
            
                <li><a href="..&#x2F;classes/thrust.util.array.html">thrust.util.array</a></li>
            
                <li><a href="..&#x2F;classes/thrust.util.collection.html">thrust.util.collection</a></li>
            
                <li><a href="..&#x2F;classes/thrust.util.func.html">thrust.util.func</a></li>
            
                <li><a href="..&#x2F;classes/thrust.util.obj.html">thrust.util.obj</a></li>
            
                <li><a href="..&#x2F;classes/thrust.util.type.html">thrust.util.type</a></li>
            
                <li><a href="..&#x2F;classes/thrust.util.url.html">thrust.util.url</a></li>
            
                <li><a href="..&#x2F;classes/thrust.util.when.html">thrust.util.when</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/thrust.html">thrust</a></li>
            
                <li><a href="..&#x2F;modules/thrust.config.html">thrust.config</a></li>
            
                <li><a href="..&#x2F;modules/thrust.data.html">thrust.data</a></li>
            
                <li><a href="..&#x2F;modules/thrust.data.config.html">thrust.data.config</a></li>
            
                <li><a href="..&#x2F;modules/thrust.data.convention.html">thrust.data.convention</a></li>
            
                <li><a href="..&#x2F;modules/thrust.dom.html">thrust.dom</a></li>
            
                <li><a href="..&#x2F;modules/thrust.dom.config.html">thrust.dom.config</a></li>
            
                <li><a href="..&#x2F;modules/thrust.dom.convention.html">thrust.dom.convention</a></li>
            
                <li><a href="..&#x2F;modules/thrust.mediator.html">thrust.mediator</a></li>
            
                <li><a href="..&#x2F;modules/thrust.mediator.config.html">thrust.mediator.config</a></li>
            
                <li><a href="..&#x2F;modules/thrust.mediator.convention.html">thrust.mediator.convention</a></li>
            
                <li><a href="..&#x2F;modules/thrust.spa.html">thrust.spa</a></li>
            
                <li><a href="..&#x2F;modules/thrust.spa.config.html">thrust.spa.config</a></li>
            
                <li><a href="..&#x2F;modules/thrust.spa.convention.html">thrust.spa.convention</a></li>
            
                <li><a href="..&#x2F;modules/thrust.template.html">thrust.template</a></li>
            
                <li><a href="..&#x2F;modules/thrust.template.config.html">thrust.template.config</a></li>
            
                <li><a href="..&#x2F;modules/thrust.template.convention.html">thrust.template.convention</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.html">thrust.util</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.array.html">thrust.util.array</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.collection.html">thrust.util.collection</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.func.html">thrust.util.func</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.obj.html">thrust.util.obj</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.type.html">thrust.util.type</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.url.html">thrust.util.url</a></li>
            
                <li><a href="..&#x2F;modules/thrust.util.when.html">thrust.util.when</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\spa\main.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define([
    &#x27;require&#x27;,
    &#x27;thrust&#x27;,
    &#x27;thrust&#x2F;util&#x27;,
    &#x27;thrust&#x2F;log&#x27;,
    &#x27;davis&#x27;,
    &#x27;jquery&#x27;,
    &#x27;domReady&#x27;
],
function (require, Thrust, util, log, Davis, jQuery, domReady)
{
    var each       = util.each,
        isString   = util.isString,
        isArray    = util.isArray,
        isFunction = util.isFunction,
        isObject   = util.isObject,
        extend     = util.extend,
        once       = util.once,
        when       = util.when,
        bind       = util.bind,
        invoke     = util.invoke,
        pluck      = util.pluck,
        map        = util.map,
        defer      = util.defer,
        memoize    = util.memoize,
        toArray    = util.toArray,
        START      = &#x27;start&#x27;;

    &#x2F;**

    @for thrust.spa
    @class thrust.spa.SinglePageApp
    @constructor
    @param {Object} config The thrust instance configuration
    @param {String} instanceName The thrust instance name
    @param {thrust.mediatorMediator} mediator The thrust instance mediator
    **&#x2F;
    var SinglePageApp = function (config, &#x2F;* $ref : name *&#x2F; instanceName, mediator)
    {
        &#x2F;&#x2F; Need to build a shim for the jQuery methods Davis needs.
        if (!Davis.$) Davis.$ = jQuery;

        var that = this;
        that.baseUrl = config.url.path + &#x27;&#x2F;&#x27;;

        config = config.spa;

        that.thrustInstanceName = instanceName;
        that.router = new Davis.App();
        that.router.configure(function (config)
        {
            config.generateRequestOnPageLoad = true;
        });

        that.loadRoutes(config.routes);
        
        var eventFactory = memoize(function (event)
        {
            return function ()
            {
                mediator.fire.async.apply(mediator, [event].concat(toArray(arguments)));
            };
        });

        &#x2F;&#x2F; Forward events
        &#x2F;&#x2F; Technically we should wrap certian parts of the events, to offer a common api that won&#x27;t shift.
        &#x2F;**
        The &#x60;thrust&#x2F;spa&#x2F;start&#x60; event is wrapped by thrust, and fired through Davis.js.


        NOTE: Marked as private because this event exposes underlying Davis arguments, and may
        be changed in the future.

        @event thrust&#x2F;spa&#x2F;start
        @private
        **&#x2F;
        that.router.bind(&#x27;start&#x27;, eventFactory(&#x27;thrust&#x2F;spa&#x2F;start&#x27;));
        &#x2F;**
        The &#x60;thrust&#x2F;spa&#x2F;route&#x2F;lookup&#x60; event is wrapped by thrust, and fired through Davis.js.


        NOTE: Marked as private because this event exposes underlying Davis arguments, and may
        be changed in the future.

        @event thrust&#x2F;spa&#x2F;route&#x2F;lookup
        @private
        **&#x2F;
        that.router.bind(&#x27;lookupRoute&#x27;, eventFactory(&#x27;thrust&#x2F;spa&#x2F;route&#x2F;lookup&#x27;));
        &#x2F;**
        The &#x60;thrust&#x2F;spa&#x2F;route&#x2F;run&#x60; event is wrapped by thrust, and fired through Davis.js.


        NOTE: Marked as private because this event exposes underlying Davis arguments, and may
        be changed in the future.

        @event thrust&#x2F;spa&#x2F;route&#x2F;run
        @private
        **&#x2F;
        that.router.bind(&#x27;runRoute&#x27;, eventFactory(&#x27;thrust&#x2F;spa&#x2F;route&#x2F;run&#x27;));
        &#x2F;**
        The &#x60;thrust&#x2F;spa&#x2F;route&#x2F;run&#x60; event is wrapped by thrust, and fired through Davis.js.


        NOTE: Marked as private because this event exposes underlying Davis arguments, and may
        be changed in the future.

        @event thrust&#x2F;spa&#x2F;route&#x2F;notfound
        @private
        **&#x2F;
        that.router.bind(&#x27;routeNotFound&#x27;, eventFactory(&#x27;thrust&#x2F;spa&#x2F;route&#x2F;notfound&#x27;));
        &#x2F;**
        The &#x60;thrust&#x2F;spa&#x2F;request&#x2F;halt&#x60; event is wrapped by thrust, and fired through Davis.js.


        NOTE: Marked as private because this event exposes underlying Davis arguments, and may
        be changed in the future.

        @event thrust&#x2F;spa&#x2F;request&#x2F;halt
        @private
        **&#x2F;
        that.router.bind(&#x27;requestHalted&#x27;, eventFactory(&#x27;thrust&#x2F;spa&#x2F;request&#x2F;halt&#x27;));
        &#x2F;**
        The &#x60;thrust&#x2F;spa&#x2F;unsupported&#x60; event is wrapped by thrust, and fired through Davis.js.

            
        NOTE: Marked as private because this event exposes underlying Davis arguments, and may
        be changed in the future.

        @event thrust&#x2F;spa&#x2F;unsupported
        @private
        **&#x2F;
        that.router.bind(&#x27;unsupported&#x27;, eventFactory(&#x27;thrust&#x2F;spa&#x2F;unsupported&#x27;));
    };

    SinglePageApp.prototype = {
        &#x2F;**
        Start the single page app router.

        @method start
        **&#x2F;
        start: function ()
        {
            var that = this;
            that.router.start();
        },
        &#x2F;**
        Loads routes into the spa instance

        Routes can be in 3 forms

            {
                &#x27;&#x2F;path&#x2F;to&#x2F;:foo&#x27;: &#x27;path&#x2F;to&#x2F;module&#x27;,
                &#x27;&#x2F;path&#x2F;to&#x2F;:bar&#x27;: [&#x27;path&#x2F;to&#x2F;module1&#x27;, &#x27;path&#x2F;to&#x2F;module2&#x27;],
                &#x27;&#x2F;path&#x2F;to&#x2F;:fb&#x27;: { path: &#x27;path&#x2F;to&#x2F;module&#x27;, args: [&#x27;args&#x27;, &#x27;to&#x27;, &#x27;hand off to start&#x27;] }
                &#x27;&#x2F;path&#x2F;to&#x2F;:foo&#x2F;:bar&#x27;: function(){  custom handler }
            }

        @method loadRoutes
        @param {Object} routes Object of routes.
        **&#x2F;
        loadRoutes: function (routes)
        {
            var that = this;
            each(routes, function (value, route)
            {
                var realRoute = util.fixupUrl(that.baseUrl + route);
                if (isFunction(value))
                {
                    that.router.get(realRoute, value);
                    &#x2F;&#x2F; Run custom function in davis.
                }
                &#x2F;*else if (isArray(value))
                {
                    var routeResult = map(value, that.__processRoute);

                    that.router.get(realRoute, function (req)
                    {
                        invoke(routeResult, &#x27;cb&#x27;, req);
                    });

                    when.all(pluck(routeResult, &#x27;promise&#x27;))
                        .then(bind(that.startModules, that, map(value, function(x)
                        {
                            return isObject(x) &amp;&amp; x.args || [];
                        })));
                }*&#x2F;
                else
                {
                    var routeResult = that.__processRoute(value);

                    that.router.get(realRoute, routeResult);
                    &#x2F;&#x2F;routeResult.promise.then(bind(that.startModules, that, value.args || []));
                }
            });
        },
        &#x2F;**
        Process each route node depending if it is an object or string.

        @method __processRoute
        @private
        @param {Object|String} value The module or module + args to process.
        **&#x2F;
        __processRoute: function(value)
        {
            var that = this,
                args = value.args || [];

            if (isObject(value))
            {
                return that.routeGetModuleFactory(value.path, args);
            }
            else if (isString(value))
            {
                return that.routeGetModuleFactory(value, args);
            }
        },
        &#x2F;**
        Creates a method that is handed off to the router
        When the route invokes that module, it will asyncronously load the given module, and return a promise for the result.

        @method routeGetModuleFactory
        @param {String} modulePath The path to the module
        @param {Function} themMethod The method that is called, after the function is resolved.
        @returns {Promise} The promise for when the module gets loaded.
        **&#x2F;
        routeGetModuleFactory: function (modulePath, args)
        {
            var that = this;

            return function (req)
            {
                var mp;
                if (modulePath.indexOf(&#x27;:&#x27;) &gt; -1)
                {
                    mp = util.reduce(req.params, function (memo, param, i) { return memo.replace(&#x27;:&#x27; + i, param.toLowerCase()); }, modulePath);
                    if (mp.lastIndexOf(&#x27;.&#x27;) &gt; -1)
                        mp = mp.substring(0, mp.lastIndexOf(&#x27;.&#x27;));
                }
                that.startModules(args, mp);
            };
        },
        &#x2F;**
        Starts the given modules, if only one module is passed in, it will start that individually.

        @method startModules
        @param {Array of Object} args to pass onto thrust&#x27;s start method.
        @param {Array of Module|Module} modules The modules to start
        **&#x2F;
        startModules: function (args, module)
        {
            var that = this;

            if (!that.thrust)
                that.thrust = Thrust.getInstance(that.thrustInstanceName);

            if (isArray(module))
            {
                each(module, function (x)
                {
                    defer(function ()
                    {
                        var promise = that.thrust.start.apply(that.thrust, [x].concat(args));
                        if (!that.thrust.started)
                            promise.then(function ()
                            {
                                that.thrust.ready(x);
                            });
                    });
                });
            }
            else
            {
                var promise = that.thrust.start.apply(that.thrust, [module].concat(args));
                if (!that.thrust.started)
                    promise.then(function ()
                    {
                        that.thrust.ready(module);
                    });

                that.startingModulePromise = [promise];
            }
        }
    };

    return SinglePageApp;
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
