/*! thrust-js - v0.1.0 - 2013-01-01 */define("thrust/template/config",["require","exports"],function(e,t){t.resolve=["cfg","data"],t.conventions=["thrust/template/convention/template","thrust/template/convention/knockout.engine"],t.types={doT:"doT",precompiled:!0},t.evaluators={doT:{left:"{{= ",right:"}}"}},t.defaultType="doT",t.baseUrl="",t.extension=".tmpl",t.templatePaths={doT:"doT"}}),define("thrust/template/main",["require","exports","thrust/util","domReady","thrust/facade","./config"],function(e,t,n,r,i,s){var o=n,u=o._,a=r,f=i,l=s;t.className="Template",l;var c="long",h="short",p="id",d=u.merge,v=o.format,m=u.each,g=u.bind,y=o.when,b=u.reduce,w=u.memoize,E=u.map,S=u.extend,x=function(e,t){var n=this,r=(n.shortName(e)+"."+(t||n.config.defaultType)+n.config.extension).toLowerCase();return r},T=function(e){var t=this,n=b(t.templateTypes,function(e,n){return e.replace("."+n.toLowerCase()+t.config.extension,"")},e.toLowerCase()).toLowerCase();return n},N=function(e){var t=this,n=t.shortName(e).replace(/\//g,"-");return n},C=function(){function t(t,n){var r=this,i=this.config=t.template;r.templateTypes=E(i.types,function(e,t){return t}),r.templates={"long":{},"short":{},id:{}},r.longName=w(g(x,r)),r.shortName=w(g(T,r)),r.templateId=w(g(N,r)),r.engines={},r.data=n,e([i.templatePaths[i.defaultType]||"thrust/template/"+i.defaultType],function(e){r.engines[i.defaultType]=e,a(function(){u(document.getElementsByTagName("script")).filter(function(e){return!!e.getAttribute("data-template")}).each(g(r.createFromDomNode,r))})})}return t.prototype.get=function(e){var t=null,n=this,r=n.templates;return(t=r.long[n.longName(e)])?t:(t=r.short[n.shortName(e)])?t:(t=r.id[n.templateId(e)])?t:null},t.prototype.set=function(e,t,n,r){var i=this,s=i.shortName(e),o=i.templateId(e),u=i.longName(e,t),a=i.templates;a.long[u]=a.short[s]=a.id[o]={name:e,shortName:e,id:o,type:t,html:r,compiled:n}},t.prototype.has=function(e){var t=this;return!!t.get(e)},t.prototype.newTemplate=function(e,t,n,r){var i=this,s=i.get(e);if(!s)if(t=="precompiled")i.set(e,t,n,n.toString());else{var o,u=this.compile(n,r);i.set(e,t,u,n)}return i.get(e)},t.prototype.compile=function(e,t){var n=this,r;return t||(t=n.engines[n.config.defaultType]),typeof t=="function"?r=t:typeof t.template=="function"&&(r=t.template),r(e)},t.prototype.fetch=function(t,n){var r=this,n=n||r.config.defaultType,i=r.shortName(t),s=r.longName(t,n),o,u=y.defer();return(o=r.get(t))?(u.resolve(o),u.promise):(r.data.get(r.config.baseUrl+s,{contentType:"text/plain",dataType:"text",silent:!0}).then(y.apply(function(i){if(n=="precompiled"){var s=r.newTemplate(t,n,i);u.resolve(s)}else if(r.engines[n]){var s=r.newTemplate(t,n,i,r.engines[n]);u.resolve(s)}else e([r.config.templatePaths[n]||"thrust/template/"+n],function(e){r.engines[n]=e;var s=r.newTemplate(t,n,i,e);u.resolve(s)})}),u.reject),u.promise)},t.prototype.createFromDomNode=function(e){var t=this;t.newTemplate(e.getAttribute("data-template"),e.getAttribute("data-type"),e.text)},t.prototype.createFacade=function(e,t,n){var r=e.template,i=n.template=new k(t,this);return t.templates={fetch:g(r.fetch,r),get:g(r.get,r),has:g(r.has,r)},i},t.config=l,t}();t.Template=C;var k=function(){var e=f.createFacade(function(e,t){this.name=e.name+"-template",this.module=e,this.parent=t,this.__conventions=t.__conventions,S(this,{fetch:g(t.fetch,t),get:g(t.get,t),has:g(t.has,t)})});return e}()}),define("thrust/template",["thrust/template/main"],function(e){return e}),define("thrust/template/convention/knockout.engine",["require","exports","thrust/convention","thrust/util","knockout"],function(e,t,n,r,i){var s=n,o=s.Convention,u=r,a=u._,f=i,l=u.when,c=a.each,h=Object.prototype.hasOwnProperty,p=a.find,d={},v=function(e){var t=f.templateSources.thrustTemplate=function(e){this.template=e};t.prototype={text:function(){var e=this;if(arguments.length===0)return e.template.html;e.template.html=arguments[0]},data:function(e){var t=this;t.template.data||(t.template.data={});if(arguments.length===1)return t.template.data[e];t.template.data[e]=arguments[1]}};var n=f.nativeTemplateEngine.instance,r=f.conventionTemplateEngine=function(){};r.prototype=f.utils.extend(new f.templateEngine,{renderTemplateSource:function(t,r,i){if(t.template){var s=this.evaluators;s||(this.evaluators=s=e.config.evaluators[e.config.defaultType]);var o=t.data("precompiled");o||(o=e.compile("{{ with($data) { }} "+t.text()+" {{ } }}"),t.data("precompiled",o));var u=t.template.compiled(r).replace(/\s+/g," ");return f.utils.parseHtmlFragment(u)}return n.renderTemplateSource.apply(n,arguments)},createJavaScriptEvaluatorBlock:function(t){if(!this.evaluatorCache){var n=e.config.evaluators[e.config.defaultType];this.evaluatorCache=n.left+t+n.right}return this.evaluatorCache},makeTemplateSource:function(r,i){if(typeof r=="string"){var s=e.get(r);if(s)return new t(s)}return n.makeTemplateSource.apply(n,arguments)}}),f.setTemplateEngine(new f.conventionTemplateEngine)},m={countdown:function(e){return v(e.template),null}};t.subscription=new o(m)}),define("thrust/template/convention/template",["require","exports","thrust/convention","thrust/util"],function(e,t,n,r){var i=n,s=i.Convention,o=r,u=o._,a="templates",f=o.when,l=u.each,c=Object.prototype.hasOwnProperty,h=u.find,p={properties:[a],init:function(e,t){var n=f.defer(),r=t.convention(a),i=o.invert(r),s=t.instance;if(r){var c=[];l(r,function(t){typeof t=="string"&&c.push(e.fetch(t))}),e.loadingPromise=f.all(c).then(function(e){u.each(i,function(t,n){var r=u.find(e,function(e){return e.shortName===n||e.name===n});s.templates[n]=r.compiled})})}return null},ready:function(e,t){return e.loadingPromise||undefined}};t.subscription=new s(p)});