/*! Thrust JS Framework - v0.1.0 - 2012-09-23
* thrust-home
* Copyright (c) 2012 David Driscoll; Licensed MIT */
define("thrust/template/main",["require","thrust/util","thrust/data","thrust/log","thrust/config","domReady","lodash","thrust/facade"],function(a,b,c,d,e,f,g,h){var i="long",j="short",k="id",l={"long":{},"short":{},id:{}},m=b.deepCopy,n=b.format,o=b.each,p=b.bind,q=b.when,r=b.memoize,s=function(a,b){var c=this;return(c.shortName(a)+"."+(b||c.defaultType)+c.extension).toLowerCase()},t=function(a){var c=this;return b.reduce(c.templateTypes,function(a,b){return a.replace("."+b.toLowerCase()+c.extension,"")},a.toLowerCase()).toLowerCase()},u=function(a){return this.shortName(a).replace(/\//g,"-")},v=function(c,d){var e=this;c=c.template,e.extension=c.extension,e.templatePaths=c.types,e.templateTypes=b.map(c.types,function(a,b){return b}),e.baseUrl=c.baseUrl,e.defaultType=c.defaultType,e.evaluators=c.evaluators,e.templates=m({},l),e.longName=r(p(s,e)),e.shortName=r(p(t,e)),e.templateId=r(p(u,e)),e.engines={},e.data=d,a([e.templatePaths[c.defaultType]||"thrust/template/"+c.defaultType],function(a){e.engines[c.defaultType]=a,f(function(){g(document.getElementsByTagName("script")).filter(function(a){return!!a.getAttribute("data-template")}).forEach(p(e.createFromDomNode,e))})})};v.prototype={get:function(a){var b=null,c=this,d=c.templates;return(b=d[i][c.longName(a)])?b:(b=d[j][c.shortName(a)])?b:(b=d[k][c.templateId(a)])?b:!1},set:function(a,b,c,d){var e=this,f=e.shortName(a),g=e.templateId(a),h=e.longName(a,b),l=e.templates;l[i][h]=l[j][f]=l[k][g]={name:a,shortName:a,id:g,type:b,html:d,compiled:c}},has:function(a){var b=this;return!!b.get(a)},newTemplate:function(a,b,c,d){var e=this,f=e.get(a);if(!f)if(b=="precompiled")e.set(a,b,c,c.toString());else{var g,h=this.compile(c,d);e.set(a,b,h,c)}return e.get(a)},compile:function(a,b){var c=this,d;return b||(b=c.engines[c.defaultType]),typeof b=="function"?d=b:typeof b.template=="function"&&(d=b.template),d(a)},fetch:function(b,c){var d=this,c=c||d.defaultType,e=d.shortName(b),f=d.longName(b,c),g,h=q.defer();return(g=d.get(b))?(h.resolve(g),h.promise):(d.data.get(d.baseUrl+f,{contentType:"text/plain",dataType:"text",silent:!0}).then(q.apply(function(e){if(c=="precompiled"){var f=d.newTemplate(b,c,e);h.resolve(f)}else if(d.engines[c]){var f=d.newTemplate(b,c,e,d.engines[c]);h.resolve(f)}else a([d.templatePaths[c]||"thrust/template/"+c],function(a){d.engines[c]=a;var f=d.newTemplate(b,c,e,a);h.resolve(f)})}),h.reject),h.promise)},createFromDomNode:function(a){var b=this;b.newTemplate(a.getAttribute("data-template"),a.getAttribute("data-type"),a.text)}};var w=h.createFacade(function(a,c){this.name=a.name+"-template",this.module=a,this.parent=c,this.__conventions=c.__conventions,b.extend(this,{fetch:p(c.fetch,c),get:p(c.get,c),has:p(c.has,c)})});return v.prototype.createFacade=function(a,b,c){var d=a.template;c.template=new w(b,this),b.templates={fetch:p(d.fetch,d),get:p(d.get,d),has:p(d.has,d)}},v}),define("thrust/template",["thrust/template/main"],function(a){return a}),define("thrust/template/convention/template",["thrust/convention","thrust/util"],function(a,b){var c="templates",d=b.when,e=b.each,f=Object.prototype.hasOwnProperty,g=b.find;return new a({properties:[c],init:function(a,h){var i=d.defer(),j=h.convention(c),k=b.invert(j),l=h.instance;j&&(a.defers=[],e(j,function(b){typeof b=="string"&&a.defers.push(a.fetch(b))}),a.defers=d.all(a.defers).then(function(a){for(var b in k)if(f.call(k,b)){var c=g(a,function(a){return a.shortName===b||a.name===b});l.templates[b]=c.compiled}}))},ready:function(a){return[a.defers]||undefined}})}),define("thrust/template/convention/knockout.engine",["thrust/convention","thrust/util","knockout"],function(a,b,c){var d=b.when,e=b.each,f=Object.prototype.hasOwnProperty,g=b.find,h={},i=function(a){var b=c.templateSources.thrustTemplate=function(a){this.template=a};b.prototype={text:function(){var a=this;if(arguments.length===0)return a.template.html;a.template.html=arguments[0]},data:function(a){var b=this;b.template.data||(b.template.data={});if(arguments.length===1)return b.template.data[a];b.template.data[a]=arguments[1]}};var d=c.nativeTemplateEngine.instance,e=c.conventionTemplateEngine=function(){};e.prototype=c.utils.extend(new c.templateEngine,{renderTemplateSource:function(b,e,f){if(b.template){var g=this.evaluators;g||(this.evaluators=g=a.evaluators[a.defaultType]);var h=b.data("precompiled");h||(h=a.compile("{{ with($data) { }} "+b.text()+" {{ } }}"),b.data("precompiled",h));var i=b.template.compiled(e).replace(/\s+/g," ");return c.utils.parseHtmlFragment(i)}return d.renderTemplateSource.apply(d,arguments)},createJavaScriptEvaluatorBlock:function(b){if(!this.evaluatorCache){var c=a.evaluators[a.defaultType];this.evaluatorCache=c.left+b+c.right}return this.evaluatorCache},makeTemplateSource:function(c,e){if(typeof c=="string"){var f=a.get(c);if(f)return new b(f)}return d.makeTemplateSource.apply(d,arguments)}}),c.setTemplateEngine(new c.conventionTemplateEngine)};return new a({countdown:function(a){i(a.template)}})});