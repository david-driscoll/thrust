/*! Thrust JS Framework - v0.1.0 - 2012-09-23
* thrust-home
* Copyright (c) 2012 David Driscoll; Licensed MIT */
define("thrust/data/config",["require"],function(a){var b={resolve:["name","mediator","cfg"],cache:!0,startTimeout:100,finishTimeout:2e3,conventions:["thrust/data/convention/start"]};return b}),define("thrust/data/event.types",{wait:"thrust/data/wait",start:"thrust/data/start",status:"thrust/data/status",stop:"thrust/data/stop",event:{beforeSend:"thrust/data/event/before-send",start:"thrust/data/event/start",send:"thrust/data/event/send",error:"thrust/data/event/error",success:"thrust/data/event/sucess",complete:"thrust/data/event/complete",stop:"thrust/data/event/stop"}}),define("thrust/data/event.factory",["thrust/util","./event.types"],function(a,b){var c=a.camelCase,d=a.format,e=a.bind,f=b.event,g=Array.prototype.slice,h=a.memoize,i={"before-send":!0,send:!0,error:!0,success:!0,complete:!0,start:!0,stop:!0},j=function(a,b){this.fire(f.beforeSend,a,b)},k=h(function(a){var b=f[a];return function(){var a=g.call(arguments,0);a.unshift(b),this.fire.apply(this.fire.async,a)}}),l=function(a){a=a.split(" ");for(var b=0,c=a.length;b<c;b++){if(!i[a[b]])throw new Error(d('Event "{0}" is not a valid data event',a[b]));a[b]=f[a[b]]}return a.join(" ")},m=function(a){return function(b,c,d){if(!d.__mediator_data_fired__)throw c.abort(),new Error("Request aborted, all ajax calls must pass through thrust-data.");d.silent||k(a).apply(this,arguments)}};return{init:function(a){for(var b in i){var d="ajax-"+b,f=k(b);b==="send"&&(f=e(m(b),this)),a.on(c(d)+this.namespace,f)}},beforeSendMethod:j}}),define("thrust/data/response.queue",["jquery","thrust/util","thrust/config","thrust/log","./event.types","has"],function(a,b,c,d,e,f){var g=Array.prototype.slice,h=b.format,i=b.extend,j=b.when,k=b.uniqueId,l=a.ajax,m=e.wait,n=e.start,o=e.stop,p=e.status,q={},r=function(a,b){return function(){a._xhr||(a._xhr=b,a.getAllResponseHeaders=function(){return a._xhr.getAllResponseHeaders()},a.getResponseHeader=function(){return a._xhr.getAllResponseHeadersgetResponseHeader()},a.abort=function(){return a._xhr.abort()},a.setRequestHeader=function(b,c){return a._xhr.setRequestHeader(b,c)}),a.responseText=b.responseText,a.responseXML=b.responseXML,a.readyState=b.readyState,a.status=b.status,a.statusText=b.statusText}},s=function(a){return function(){return a(b.toArray(arguments))}},t=function(a){return function(){return a.call(this,arguments[0][0])}},u=function(a,b,c){this.startTimeout=b,this.finishTimeout=c,this.module=a};return u.prototype={addToQueue:function(a,b,c){var d=j.defer(),e=this;if(c.beforeSend){var f=c.beforeSend;d.progress(function(a){if(a&&a=="before-send"){var b=g.call(arguments,1);f.apply(f,b)}}),delete c.beforeSend}c.complete&&(d.always(c.complete),delete c.complete),c.success&&(d.then(c.success),delete c.success),c.error&&(d.otherwise(c.error),delete c.error);var h=!!q[a],k=q[a]||(q[a]={}),l=k.tail||(k.tail=k.next={});return i(l,{url:b,options:c,dfo:d}),k.tail=l.next={},h||j.delay(e.startTimeout).then(e.process(a)),d.promise},process:function(a){var b=q[a],c=b,e=this,f=k("dq");return!1,e.module.fire(m,f,a),function(){!1;var b=[],g=j.defer(),k=0;g.then(function(){!1,e.module.fire(o,f,a,k)}),delete q[a];var m=c.tail,t=function(){e.module.fire(p,f,a,++k)};while((c=c.next)!==m){var u=c.dfo,v=i({},c.options),w=j.defer(),x=c.xhr=l(c.url,v).then(s(w.resolve),s(w.reject));w.then(t),b.push(x),j.all([w,g.promise],j.apply(u.resolve),j.apply(u.reject),r(u,x)),u.progress("before-send",[u,v])}e.module.fire(n,f,a,b.length),j.any([j.all(b),j.delay(e.finishTimeout)],g.resolve,g.resolve)}}},u}),define("thrust/data/main",["jquery","thrust/util","thrust/log","thrust/data/config","thrust/config","./event.factory","./response.queue","thrust/events","thrust/facade","./event.types","has"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b.format,m=b.extend,n=b.type,o=b.when,p=Array.prototype.slice,q=a.ajax,r=b.uniqueId,s=j.wait,t=j.start,u=j.stop,v=j.status,w=function(a){return function(){return a(b.toArray(arguments))}};a.ajaxSettings.traditional=!!e.url.traditionalEncoding;var x=a(document);f.init(x);var y=i.createFacade(function(a,b){this.name=a.name+"-data",this.module=a,this.parent=b,this.__conventions=b.__conventions,this._callbacks=b._callbacks,this.responseQueue=b.responseQueue,this.initEvents(),this.defaults=b.defaults,this.appPath=b.appPath});b.extend(y.fn,h);var z=function(a,b,d){if(!(this instanceof z))return new z(a,b);if(!a)throw new Error("Data: module name must be defined.");this.responseQueue=new g(this,d.data.startTimeout,d.data.finishTimeout),!1,this.mediator=b,this._callbacks=this.mediator._callbacks,this.initEvents(),this.defaults={cache:d.data.cache,beforeSend:f.beforeSendMethod,contentType:"application/json",type:"POST",url:"",data:"",dataType:"json",__mediator_data_fired__:!0,silent:!1},this.appPath=d.url.path+"/"},A={createFacade:function(a,b,c){if(!b.data||c.data instanceof y){var d;return c.data?(c.data.updateFacade(b,this),d=c.data):d=c.data=b.data=new y(b,this),d}throw new Error('"data" is a reserved property')}},B={getData:function(a,b,c){return c=c?m(c,{data:b}):{data:b},this.get(a,c)},postData:function(a,b,c){return c=c?m(c,{data:JSON.stringify(b)}):{data:JSON.stringify(b)},this.post(a,c)},get:function(a,b,c){b===undefined&&typeof a=="object"&&(b=a,a=b.url),a===undefined&&b.url!==undefined&&(a=b.url);if(a===undefined)throw new Error("No url is defined");return this.ajax(a,m(b||{},{type:"get"}),c)},post:function(a,b,c){b===undefined&&typeof a=="object"&&(b=a,a=b.url),a===undefined&&b.url!==undefined&&(a=b.url);if(a===undefined)throw new Error("No url is defined");return this.ajax(a,m(b||{},{type:"post"}),c)},ajax:function(a,d,e){var g=this,h,i,j;!1,d===undefined&&typeof a=="object"&&(d=a,a=d.url),d||(d={}),a===undefined&&d.url!==undefined&&(a=d.url),a=b.fixupUrl(a,g.appPath);var k=g.module&&g.module.module;if(d.silent){var n=o.defer(),p=r("dq");return i=d.type.toLowerCase(),h=m({},g.defaults,{beforeSend:b.noop},d),q(a,h).then(w(n.resolve),w(n.reject)),n.promise}return h=m({},g.defaults,d,{beforeSend:f.beforeSendMethod}),i=h.type.toLowerCase(),this.responseQueue.addToQueue(i,a,h)}};return b.extend(y.fn,B),z.prototype=z.fn=b.extend({},A,B,h),a.ajax=z.ajax,z}),define("thrust/data",["thrust/data/main"],function(a){return a}),define("thrust/data/convention/start",["thrust/convention","thrust/util"],function(a,b){var c=b.when,d=[],e=function(a){var b=c.defer();b.resolver.uid=a,d.push({uid:a,resolver:b.resolver})},f=function(a){var c=b.find(d,function(b){return b.uid===a});d=b.without(d,c),c.resolver.resolve()};return new a({countdown:function(a){a.data.subscribe("thrust/data/wait",e),a.data.subscribe("thrust/data/stop",f)},orbit:function(a){a.data.unsubscribe("thrust/data/wait",e),a.data.unsubscribe("thrust/data/stop",f);var b=c.defer();return a.cfg.data.finishTimeout===0?c.all(d):c.any([c.all(d),c.delay(a.cfg.data.finishTimeout)],b.resolve,b.reject)}})});